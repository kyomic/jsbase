define(function(require,exports,module){var PlayerCtrl=function(MP){var $C=MP.css,$D=MP.dom,domConfig=MP.miniPlayer.domConfig,arrSongAttr=["mid","msong","msingerid","msinger","malbumid","malbum","msize","minterval","mstream","mdownload","msingertype","size320","size128","mrate","gososo","sizeape","sizeflac","sizeogg"],arrSongAttrSoso=["mid","msong","malbum","msinger","msize","mformat","mrate","minterval","msongurl","msingerid","malbumid","mdownload","mshowurl"],mapMyFav=null,loadingMyFav=false;function getSongData(elm){var re=
new RegExp('<\\w[^>]+class="?data"?[^>]*>(.*?)<\\/\\w[^>]*>',"i"),songdata="";if((songdata=re.exec(elm.innerHTML.replace(/&amp;/g,"&")))!=null)songdata=songdata[1];return songdata}return function(){var th=this;th.formatMusic=function(songdata){var len=arrSongAttr.length,arrMusic=[],_obj={},i=0,_length=0;if(typeof songdata=="string")songdata=songdata;else if(MP.lang.isNode(songdata))songdata=getSongData(songdata);arrMusic=songdata.split("|");_length=Math.min(len,arrMusic.length);if(arrMusic.length<
10){_obj=th.formatMusic_Soso(songdata);_obj.mtype=1;_obj.mstream=0;return _obj}for(i=0;i<_length;i++)_obj[arrSongAttr[i]]=arrMusic[i];for(i=_length;i<len;i++)_obj[arrSongAttr[i]]="";_obj.mtype=3;_obj.msongurl=th.getSongUrl(_obj);return _obj};th.formatMusic_Soso=function(songdata){var re=new RegExp('<\\w[^>]+class="?data"?[^>]*>(.*?)<\\/\\w[^>]*>',"i"),len=arrSongAttrSoso.length,arrMusic=songdata.split("@@"),i=0,_length=Math.min(len,arrMusic.length),_obj={};for(i=0;i<_length;i++)_obj[arrSongAttrSoso[i]]=
arrMusic[i];for(i=_length;i<len;i++)_obj[arrSongAttrSoso[i]]="";_obj["msongurl"]=_obj["msongurl"].replace(/^.*http(.*);(.*);.*$/g,"http$1");_obj["mshowurl"]=_obj["msongurl"];return _obj};th.buildMusicData=function(musicInfo,count){count=count||arrSongAttr.length;if(musicInfo.mtype%10==1)return th.buildMusicDataSoso(musicInfo);var list=[];for(var i=0;i<count;i++)list.push(musicInfo[arrSongAttr[i]]);return list.join("|")};th.buildMusicDataSoso=function(musicInfo,count){count=count||arrSongAttrSoso.length;
var list=[];for(var i=0;i<count;i++)list.push(musicInfo[arrSongAttrSoso[i]]);return list.join("@@")};th.getSongUrl=function(songobj){var wmaurl_tpl="http://stream%(stream).qqmusic.qq.com/%(sid).mp3",url="";if(!!songobj.mid&&!!songobj.mstream&&songobj.mid>0&&songobj.mstream>0){var sid=parseInt(songobj.mid)+3E7;url=wmaurl_tpl.jstpl_format({stream:parseInt(songobj.mstream)+10,sid:sid})}else if(!!songobj.msongurl)url=songobj.msongurl;return url};th.getMyfavMap=function(uin,callback){if(!!mapMyFav){callback(mapMyFav);
return}function _error(){loadingMyFav=false}if(loadingMyFav)return;loadingMyFav=true;uin=uin||MP.user.getLoginUin();var url="http://"+MP.domain["s.plcloud.music.qq.com"]+"/fcgi-bin/fcg_musiclist_getmyfav.fcg",data={uin:uin},j=new MP.JSONGetter(url,"myFavSongMap",data,"GB2312",false);j.onSuccess=function(data){loadingMyFav=false;if(data.code!=0){_error();return}mapMyFav=data.map;!!callback&&callback(data.map)};j.onError=function(){_error()};j.send("jsonCallback")};th.setBtnLike=function(songId,status){var $aBtnLike=
MP.getById(domConfig.btnLike);if(!!songId)th.getMyfavMap(MP.user.getLoginUin(),function(mapMyFav){if(typeof status=="undefined")!mapMyFav[songId]?($C.removeClassName($aBtnLike,"current"),$aBtnLike.title="\u559c\u6b22"):(!$C.hasClassName($aBtnLike,"current")&&$C.addClassName($aBtnLike,"current"),$aBtnLike.title="\u53d6\u6d88\u559c\u6b22");else status==0?(mapMyFav[songId]&&(mapMyFav[songId]=null),$C.removeClassName($aBtnLike,"current"),$aBtnLike.title="\u559c\u6b22"):(mapMyFav[songId]=1,!$C.hasClassName($aBtnLike,
"current")&&$C.addClassName($aBtnLike,"current"),$aBtnLike.title="\u53d6\u6d88\u559c\u6b22")})};th.likeSong=function(idlist,typelist,callback){if(typelist%10==1){MP.showMsgbox("\u7f51\u7edc\u6b4c\u66f2\u4e0d\u80fd\u6807\u8bb0\u4e3a\u559c\u6b22\uff01");return}function _error(){MP.showMsgbox("\u559c\u6b22\u5931\u8d25\uff01\u5f53\u524d\u7f51\u7edc\u7e41\u5fd9\uff0c\u8bf7\u60a8\u7a0d\u540e\u91cd\u8bd5\uff01")}var uin=MP.user.getLoginUin(),url="http://"+MP.domain["s.plcloud.music.qq.com"]+"/fcgi-bin/fcg_music_add2songdir.fcg",
data={uin:uin,dirid:201,idlist:idlist,source:501,typelist:typelist%10,feed:0,formsender:1},fs=new MP.FormSender(url,"post",data,"GB2312");fs.onSuccess=function(o){switch(o.code){case 0:MP.showMsgbox(1,"\u6b4c\u66f2\u5df2\u559c\u6b22\uff0c\u60a8\u53ef\u4ee5\u5728\u201c\u6211\u559c\u6b22\u201d\u6b4c\u5355\u627e\u5230\u8fd9\u9996\u6b4c\u3002");callback&&callback();var arrTmp=idlist.split(",");th.getMyfavMap(uin,function(mapMyFav){MP.object.each(arrTmp,function(id){id>0&&(mapMyFav[id]=1)})});break;case 1:MP.user.showLoginbox();
break;case 31:case 32:case 41:var t=o.title?o.title:undefined,v='<a href="http://pay.qq.com/music/index.shtml?aid=music.bfq.gdsx.1&clientuin="'+uin+' target="_blank" title="\u5f00\u901a\u7eff\u94bb\uff0c\u7545\u4eab\u6700\u9ad825000\u9996\u7684\u8d85\u5927\u7a7a\u95f4>>">\u5f00\u901a\u7eff\u94bb\uff0c\u7545\u4eab\u6700\u9ad825000\u9996\u7684\u8d85\u5927\u7a7a\u95f4>></a>',msg=o.msg?o.msg:"";!!t&&msg!=""&&(msg=t+"<br />"+msg+v);MP.showMsgbox(msg);break;default:_error();break}};fs.onError=_error;fs.send()},
th.delLikeSong=function(idlist,typelist,callback){var uin=MP.user.getLoginUin();function _error(){MP.showMsgbox("\u53d6\u6d88\u559c\u6b22\u5931\u8d25\uff01\u5f53\u524d\u7f51\u7edc\u7e41\u5fd9\uff0c\u8bf7\u60a8\u7a0d\u540e\u91cd\u8bd5\u3002")}var url="http://"+MP.domain["qzone-music.qq.com"]+"/fcg-bin/fcg_music_delbatchsong.fcg",data={uin:uin,dirid:201,ids:idlist,source:501,types:typelist%10,formsender:1,flag:2,from:3},fs=new MP.FormSender(url,"post",data,"GB2312");fs.onSuccess=function(o){switch(o.code){case 0:MP.showMsgbox(1,
"\u6b4c\u66f2\u5df2\u53d6\u6d88\u559c\u6b22\uff0c\u5e76\u4e14\u4ece\u201c\u6211\u559c\u6b22\u201d\u6b4c\u5355\u79fb\u9664\u3002");!!callback&&callback();var _arrTmp=idlist.split(",");th.getMyfavMap(uin,function(mapMyFav){MP.object.each(_arrTmp,function(id){mapMyFav[id]=null})});break;case 1:_error();break;default:_error();break}};fs.onError=_error;fs.send()};th.setCurSongInfo=function(songInfo){var $divSongCover=MP.getById(domConfig.divSongCover),$pSongName=MP.getById(domConfig.pSongName),$divSongbarLine=
MP.getById(domConfig.divSongbarLine),$aBtnLike=MP.getById(domConfig.btnLike);if(!songInfo){$divSongbarLine.style.width="0%";return}MP.playerCtrl.PlayerOp.curSongInfo=songInfo;$pSongName.innerHTML=["<strong>",songInfo.msong.myEncode(),"</strong> - <span>",songInfo.msinger.myEncode(),"</span>"].join("");$pSongName.setAttribute("title",songInfo.msong.entityReplace().myEncode()+" - "+songInfo.msinger.entityReplace().myEncode());$aBtnLike.setAttribute("data-id",songInfo.mid);$aBtnLike.setAttribute("data-type",
songInfo.mtype);th.setBtnLike(songInfo.mid);$divSongbarLine.style.width="0%";$divSongCover.setAttribute("data-sid",songInfo.mid);$divSongCover.setAttribute("data-stype",songInfo.mtype);$divSongCover.setAttribute("data-sname",songInfo.msong.entityReplace().myEncode());$divSongCover.setAttribute("data-ssinger",songInfo.msinger);$divSongCover.setAttribute("data-ssingerid",songInfo.msingerid);$divSongCover.setAttribute("data-surl",songInfo.msongurl);$divSongCover.setAttribute("data-salbumid",songInfo.malbumid)};
th.PlayerOp=function(){return{inited:false,type:"fm",isPlaying:false,isPlayNow:true,mPlayingPos:0,curSongInfo:null,curPlayElem:null,curSettings:{volume:75,mode:2},pauseMusic:{fm:false,pl:false},ulplaylist:null,click:false,init:function(opts,callback){var self=th.PlayerOp;if(MP.lang.isFunction(opts)){callback=opts;opts=undefined}!!opts&&opts.type&&(self.type=opts.type);self.pauseMusic["pl"]=false;self.pauseMusic["fm"]=false;if(!self.inited||typeof g_webPlayer==="undefined"){MP.playerInited=self.inited=
true;require.async("v2/miniplayer_webplayer",function(){g_webPlayer.init({fromtag:28,statFromtag:5});__initCallbacks();callback&&callback()})}else{__initCallbacks();callback&&callback()}function __initCallbacks(){g_webPlayer.OnSongPlayBegin=function(songInfo,index,total){self.isPlaying=true;var uin=MP.user.getLoginUin();if(uin<10001)MP.user.showLoginbox();else th.setCurSongInfo(songInfo);self.pauseMusic["pl"]=false;self.pauseMusic["fm"]=false;self.mPlayingPos=index;self.curSongInfo=songInfo;if(self.type==
"pl")setTimeout(function(){var $e=self.ulplaylist;if(!!$e){var $es=$e.getElementsByTagName("li");if($es.length>index){if(self.curPlayElem){$C.removeClassName(self.curPlayElem,"hover");$C.removeClassName(self.curPlayElem,"current");self.curPlayElem=null}self.curPlayElem=$es[index];$C.addClassName(self.curPlayElem,"hover");$C.addClassName(self.curPlayElem,"current");if(!self.click)MP.pl.selectCurPlayElem(self.curPlayElem);else self.click=false}}},200);else{self.curPlayElem=null;if(index>=total-1){self.isPlayNow=
false;self.playFm()}}th.resetProgress()};g_webPlayer.OnSongPlayEnd=function(songInfo,index,total){self.isPlaying=false;if(self.curPlayElem){$C.removeClassName(self.curPlayElem,"hover");$C.removeClassName(self.curPlayElem,"current")}var $e=MP.getById(domConfig.btnPlay);$C.removeClassName($e,"bar_btn_pause");$C.addClassName($e,"bar_btn_play");$e.setAttribute("title","\u64ad\u653e")};g_webPlayer.OnSongPlaying=function(curtime,totaltime){if(isNaN(curtime)||isNaN(totaltime))return;if(self.isPlaying)MP.getById(domConfig.divSongbarLine).style.width=
parseInt(curtime*100/totaltime,10)+"%"};g_webPlayer.OnPlaying=function(){MP.console.print("playing ...... playbtn: ",MP.getById(domConfig.btnPlay));self.setPlayBtn(0)};g_webPlayer.OnPlayPause=function(){MP.console.print("pauseing ......  playbtn: ",MP.getById(domConfig.btnPlay));self.setPlayBtn(1)};g_webPlayer.OnPlayError=function(songInfo,index){if(songInfo.mtype%10!=1&&!!songInfo.mid&&!!songInfo.mstream&&songInfo.mid>0&&songInfo.mstream>0);else{MP.console.print("OnPlayError, \u6b4c\u66f2\u4fe1\u606f\u6709\u8bef\uff1a[mtype, mid, mstream]",
songInfo.mtype,songInfo.mid,songInfo.mstream);g_webPlayer.nextPlayer()}}}},play:function(obj,click,callback){var self=th.PlayerOp;self.click=click||false;if(!MP.playerInited)self.init(function(){__realPlay()});else __realPlay();function __realPlay(){try{MI.TalkList.musicStop();MI.Music.stop()}catch(ign){}if(self.type=="fm")self.playFm();else if(self.type=="pl")MP.initMusic(function(){if(th.PlayerOp.pauseMusic["pl"]){self.pauseMusic["pl"]=false;g_webPlayer.startPlayer()}else self.setPlayerList(function(){var pos=
0;if(!!obj)pos=self.getSelectPos(obj);g_webPlayer.playAnyPos(pos);self.setPlayBtn(0);!!callback&&callback()})})}},playFm:function(){var self=th.PlayerOp;if(!MP.fm.curFmInfo){MP.showMsgbox("\u8bf7\u9009\u62e9\u8981\u64ad\u653e\u7684\u7535\u53f0\u6216\u6b4c\u66f2\uff01");!MP.appMain.isOpen()&&MP.appMain.openMain();return}MP.initMusic(function(){if(self.pauseMusic["fm"]){self.pauseMusic["fm"]=false;g_webPlayer.startPlayer()}else self.setPlayerList(function(){self.setVol(self.curSettings.volume);if(self.isPlayNow){MP.console.print("playFm, ",
!!MP.BQQPlayer&&MP.pauseFromApp);if(!!MP.BQQPlayer&&MP.pauseFromApp){MP.pauseFromApp=false;MP.pauseAppMusic();MP.BQQPlayer.runPlayerForce(0)}else g_webPlayer.nextPlayer();self.setPlayBtn(0)}})})},setPlayerList:function(callback){var self=th.PlayerOp;if(self.type=="pl"){g_webPlayer.clearPlayerList();th.localSong.get(function(list){g_webPlayer.setPlayerList(false,list,self.curSettings.mode);callback&&callback()})}else if(self.type=="fm")MP.fm.loadFmSonglist(MP.fm.curFmInfo,function(songList){if(!!self.curSongInfo&&
MP.fm.isDefaultFm)songList.unshift(self.curSongInfo);g_webPlayer.setPlayerList(false,songList,self.curSettings.mode);callback&&callback()})},getLocalCount:function(){var count=0;th.localSong.get(function(list){count=list.length});return count},getSelectPos:function(obj){var $es=MP.getById(obj).parentNode.getElementsByTagName("li"),i=0,len=$es.length;for(;i<len;i++)if($es[i]==obj)return i;return-1},pause:function(){try{MP.initMusic(function(){th.PlayerOp.pauseMusic[th.PlayerOp.type]=true;g_webPlayer&&
g_webPlayer.pausePlayer()})}catch(ign){MP.console.print("pause player exp:"+ign.message);return false}},next:function(){try{MI.TalkList.musicStop();MI.Music.stop()}catch(ign){}var self=th.PlayerOp;if(self.curPlayElem){$C.removeClassName(self.curPlayElem,"hover");$C.removeClassName(self.curPlayElem,"current")}if(self.type=="fm"&&!MP.fm.curFmInfo){MP.showMsgbox("\u8bf7\u9009\u62e9\u8981\u64ad\u653e\u7684\u7535\u53f0\u6216\u6b4c\u66f2\uff01");!MP.appMain.isOpen()&&MP.appMain.openMain();return}MP.initMusic(function(){if(self.type==
"fm"){if(MP.fm.isLoading)return;if(MP.fm.curFmInfo.fmType==100){self.isPlayNow=true;self.playFm()}else if(MP.fm.isDefaultFm){MP.fm.isDefaultFm=false;self.isPlayNow=true;self.playFm()}else{g_webPlayer.nextPlayer();self.setPlayBtn(0)}}else{g_webPlayer.nextPlayer();self.setPlayBtn(0)}});if(self.type=="fm")MP.hotClick("musicapp.miniplayer.nextbtn.fm","app.music.qq.com","/t.qq.com/miniplayer");else MP.hotClick("musicapp.miniplayer.nextbtn.musiclist","app.music.qq.com","/t.qq.com/miniplayer")},stop:function(){try{th.resetProgress();
g_webPlayer&&g_webPlayer.stopPlayer()}catch(ign){MP.console.print("stop player exp:"+ign.message);return false}},setVol:function(vol){g_webPlayer.setVolumn(vol)},setPlayBtn:function(status){status=typeof status==="undefined"?0:status;MP.console.print("set playbtn, status: ",status);var $e=MP.getById(domConfig.btnPlay);if(status==0){$C.removeClassName($e,"bar_btn_play");$C.addClassName($e,"bar_btn_pause");$e.setAttribute("title","\u6682\u505c");$e.innerHTML='<a href="javascript:;">\u6682\u505c</a>'}else if(status==
1){$C.removeClassName($e,"bar_btn_pause");$C.addClassName($e,"bar_btn_play");$e.setAttribute("title","\u64ad\u653e");$e.innerHTML='<a href="javascript:;">\u64ad\u653e</a>'}},add:function(newList,isPlay,click,callback){th.localSong.get(function(list){var oldlen=list.length,addlen=newList.length,newlen=th.localSong.add(newList);if(oldlen>=300){MP.hideYellowTips(1);MP.hideYellowTips(2);MP.hideYellowTips(3);var cont="<strong>\u64ad\u653e\u5217\u8868\u8d85\u8fc7300\u9996\u4e0a\u9650\uff01</strong><br />\u8bf7\u6e05\u7406\u64ad\u653e\u5217\u8868\u3002",
node="tab_list",pos="icon_arrow_foot";MP.showYellowTips(4,cont,node,pos,135,-104,3E3);MP.console.print("\u64ad\u653e\u5217\u8868\u8d85\u8fc7300\u9996\u4e0a\u9650\uff01");return}if(newlen<=oldlen){MP.console.print("\u8d85\u8fc7\u5bb9\u91cf\u4e0a\u9650\uff0c\u672c\u5730\u7535\u8111\u6700\u591a\u53ef\u4ee5\u7f13\u5b5832k\u7684\u6b4c\u66f2\uff0c\u8bf7\u5220\u9664\u64ad\u653e\u5217\u8868\u5185\u7684\u6b4c\u66f2\u30021");return}if(oldlen+addlen>newlen){if(newlen==300){MP.hideYellowTips(1);MP.hideYellowTips(2);
MP.hideYellowTips(3);var cont="<strong>\u64ad\u653e\u5217\u8868\u8d85\u8fc7300\u9996\u4e0a\u9650\uff01</strong><br />\u8bf7\u6e05\u7406\u64ad\u653e\u5217\u8868\u3002",node="tab_list",pos="icon_arrow_foot";MP.showYellowTips(4,cont,node,pos,135,-104,3E3)}else MP.console.print("\u8d85\u8fc7\u5bb9\u91cf\u4e0a\u9650\uff0c\u672c\u5730\u7535\u8111\u6700\u591a\u53ef\u4ee5\u7f13\u5b5832k\u7684\u6b4c\u66f2\uff0c\u8bf7\u5220\u9664\u64ad\u653e\u5217\u8868\u5185\u7684\u6b4c\u66f2\u30022");newList=newList.slice(0,
newlen-oldlen)}!!callback&&callback(newList);MP.console.print("add song to playlist, PlayerOp.type:",th.PlayerOp.type);if(th.PlayerOp.type=="fm"&&isPlay){th.PlayerOp.type="pl";if(!MP.playerInited)th.PlayerOp.init(function(){th.PlayerOp.setPlayerList(function(){g_webPlayer.playAnyPos(oldlen)})});else th.PlayerOp.setPlayerList(function(){g_webPlayer.playAnyPos(oldlen)})}else if(th.PlayerOp.type=="pl")if(!MP.playerInited)th.PlayerOp.init(function(){th.PlayerOp.setPlayerList(function(){isPlay&&g_webPlayer.playAnyPos(oldlen)})});
else th.PlayerOp.setPlayerList(function(){isPlay&&g_webPlayer.playAnyPos(oldlen)})})},del:function(obj){(function(self){var pos=self.getSelectPos(obj);$D.removeElement(obj);th.localSong.del(pos);if(!!self.ulplaylist&&self.ulplaylist.style.display!="none"){var _pos=pos==0?0:pos-1;MP.pl.updateSongNum();var curElem=self.ulplaylist.getElementsByTagName("li")[_pos];MP.pl.selectCurPlayElem(curElem)}if(self.type=="pl")if(pos>=0&&typeof g_webPlayer!=="undefined"&&!g_webPlayer.delSong(pos)){self.isPlaying=
false;!!g_webPlayer&&g_webPlayer.stopPlayer();self.setPlayBtn(1)}})(th.PlayerOp)},clear:function(){}}}();MP.object.extend(window,{pauseMiniplayer:th.PlayerOp.pause,stopMiniplayer:th.PlayerOp.stop,isMiniPlaying:function(){return MP.playerCtrl.PlayerOp.isPlaying}});th.localSong=function(){return{list:null,get:function(callback){var self=th.localSong,uin=MP.user.getLoginUin();if(!!self.list){callback(self.list);return}!MUSIC.widget.Storage&&(MUSIC.widget.Storage=MP.Storage);g_storage.get("miniplayer_playlist_"+
uin,function(data){var tmpList=[];if(!!data)if(window.JSON&&window.JSON.parse)try{tmpList=JSON.parse(data)}catch(ex){MP.console.print("parse playlist storage song data exp: ",ex.message);tmpList=MP.lang.isArray(data)?data:[]}else tmpList=MP.lang.isArray(data)?data:eval(data);self.list=[];MP.object.each(tmpList,function(music){var fMusic=th.formatMusic(music);self.list.push(fMusic)});callback(self.list)})},save:function(){var self=th.localSong,list=[],count=0,tmplist=[],uin=MP.user.getLoginUin(),i=
0,len=self.list.length;for(;i<len;i++){var tmp=th.buildMusicData(self.list[i]);count+=tmp.length+3;if((ua.ie==6||ua.ie==7)&&count>=32E3||i>=300){MP.console.print("save: \u8d85\u8fc7\u5bb9\u91cf\u4e0a\u9650\uff0c\u672c\u5730\u7535\u8111\u6700\u591a\u53ef\u4ee5\u7f13\u5b5832k\u7684\u6b4c\u66f2\u3002");break}tmplist.push(self.list[i]);list.push(tmp)}!MUSIC.widget.Storage&&(MUSIC.widget.Storage=MP.Storage);g_storage.set("miniplayer_playlist_"+uin,MP.lang.obj2str(list));self.list=tmplist;return list.length},
add:function(newList){var i=0,len=newList.length;for(;i<len;i++)th.localSong.list.push(newList[i]);return th.localSong.save()},del:function(index){if(index>=0&&index<th.localSong.list.length){th.localSong.list.splice(index,1);th.localSong.save()}},clear:function(){th.localSong.list=[];th.localSong.save()}}}();th.setDefaultFm=function(){MP.console.print("setDefaultFm ......");MP.cookie.del("radio");MP.cookie.del("miniplayer-radio");MP.cookie.del("miniplayer-playerlist");th.PlayerOp.type="fm";seajs.use("http://fm.qq.com/json/fm_sea_utf8.js",
function(fmData){MP.fm=MP.fm||{};MP.fm.fmListData=MP.fm.fmListData||{fmInfoObj:fmData||{"type1":[{"id":203,"name":"\u6000\u65e7\u7ca4\u8bed","i":1},{"id":198,"name":"\u70ed\u6b4c","i":1},{"id":118,"name":"\u534e\u8bed","i":1},{"id":120,"name":"\u6b27\u7f8e","i":1},{"id":119,"name":"\u7ca4\u8bed","i":1},{"id":150,"name":"\u97e9\u8bed","i":1},{"id":149,"name":"\u65e5\u8bed","i":1},{"id":168,"name":"\u6cd5\u8bed","i":1},{"id":122,"name":"70\u540e","i":1},{"id":123,"name":"80\u540e","i":1},{"id":124,
"name":"90\u540e","i":1},{"id":174,"name":"\u94a2\u7434","i":1},{"id":175,"name":"\u6728\u5409\u4ed6","i":1},{"id":176,"name":"\u5c0f\u63d0\u7434","i":1},{"id":181,"name":"\u8428\u514b\u65af","i":1},{"id":126,"name":"\u65b0\u6b4c","i":1},{"id":190,"name":"\u4e2d\u56fd\u98ce","i":1},{"id":192,"name":"\u65c5\u884c","i":1},{"id":191,"name":"\u6625\u665a\u7ecf\u5178","i":1},{"id":196,"name":"\u683c\u83b1\u7f8e","i":1},{"id":188,"name":"Billboard","i":1},{"id":187,"name":"\u7535\u5f71\u539f\u58f0","i":1},
{"id":189,"name":"\u7535\u89c6\u5267\u539f\u58f0","i":1},{"id":182,"name":"2011\u7cbe\u9009","i":1},{"id":179,"name":"\u5973\u58f0","i":1},{"id":141,"name":"\u5496\u5561\u5c4b","i":1},{"id":180,"name":"\u8317\u8336\u9986","i":1},{"id":127,"name":"\u7ecf\u5178","i":1},{"id":148,"name":"\u5531\u4f5c\u4eba","i":1},{"id":167,"name":"\u7f51\u7edc\u6d41\u884c","i":1},{"id":144,"name":"\u52a8\u6f2b","i":1},{"id":157,"name":"\u7bee\u7403","i":1},{"id":158,"name":"\u8db3\u7403","i":1},{"id":160,"name":"\u65e9\u5b89",
"i":1},{"id":161,"name":"\u665a\u5b89","i":1},{"id":142,"name":"\u5931\u7720","i":1},{"id":201,"name":"\u5965\u65af\u5361\u91d1\u66f2","i":1},{"id":159,"name":"\u6eda\u77f3\u4e09\u5341\u5e74","i":1},{"id":162,"name":"\u82f9\u679c\u5e7f\u544a","i":1},{"id":166,"name":"\u513f\u6b4c","i":1},{"id":146,"name":"\u80ce\u6559","i":1},{"id":195,"name":"\u821e\u66f2","i":1},{"id":185,"name":"\u8bf4\u5531","i":1},{"id":186,"name":"\u82f1\u4f26","i":1},{"id":183,"name":"\u84dd\u8c03","i":1},{"id":184,"name":"Bossa Nova",
"i":1},{"id":173,"name":"R&B","i":1},{"id":130,"name":"\u6d41\u884c\u6447\u6eda","i":1},{"id":132,"name":"\u7235\u58eb","i":1},{"id":133,"name":"\u4e61\u6751","i":1},{"id":129,"name":"\u8f7b\u97f3\u4e50","i":1},{"id":134,"name":"\u7535\u5b50","i":1},{"id":135,"name":"\u6162\u6447","i":1},{"id":131,"name":"\u53e4\u5178","i":1}],"type2":[{"id":143,"name":"\u9648\u5955\u8fc5","i":2},{"id":4558,"name":"\u5468\u6770\u4f26","i":2},{"id":74,"name":"\u4e94\u6708\u5929","i":2},{"id":12578,"name":"Adele","i":2},
{"id":11606,"name":"\u6797\u5ba5\u5609","i":2},{"id":4740,"name":"\u9ec4\u5c0f\u7425","i":2},{"id":4286,"name":"\u6797\u4fca\u6770","i":2},{"id":44,"name":"\u6881\u9759\u8339","i":2},{"id":24833,"name":"\u80e1\u590f","i":2},{"id":264,"name":"\u738b\u83f2","i":2},{"id":112,"name":"\u8521\u5065\u96c5","i":2},{"id":13769,"name":"Lady GaGa","i":2},{"id":10,"name":"\u9648\u7eee\u8d1e","i":2},{"id":21414,"name":"Bruno Mars","i":2},{"id":16257,"name":"Justin Bieber","i":2},{"id":141,"name":"\u5f20\u60e0\u59b9",
"i":2},{"id":4404,"name":"WestLife","i":2},{"id":6494,"name":"Whitney Houston","i":2},{"id":5161,"name":"\u4e45\u77f3\u8ba9","i":2},{"id":5675,"name":"Super Junior","i":2},{"id":4607,"name":"\u5f20\u9753\u9896","i":2},{"id":218,"name":"S.H.E","i":2},{"id":54,"name":"\u83ab\u6587\u851a","i":2},{"id":7080,"name":"The Cranberries","i":2},{"id":4880,"name":"Eminem","i":2},{"id":4660,"name":"Mariah Carey","i":2},{"id":13203,"name":"\u8427\u656c\u817e","i":2},{"id":118,"name":"\u5bb9\u7956\u513f","i":2},
{"id":4417,"name":"Avril Lavigne","i":2},{"id":126,"name":"\u5c0f\u91ce\u4e3d\u838e","i":2},{"id":109,"name":"\u5b59\u71d5\u59ff","i":2},{"id":5470,"name":"\u767d\u667a\u82f1","i":2},{"id":11424,"name":"AKB48","i":2},{"id":265,"name":"\u738b\u529b\u5b8f","i":2},{"id":13578,"name":"BY2","i":2},{"id":4620,"name":"\u90d1\u79c0\u6587","i":2},{"id":101,"name":"\u9676\u5586","i":2},{"id":113,"name":"Twins","i":2},{"id":51,"name":"\u5218\u82e5\u82f1","i":2},{"id":3347,"name":"\u53e4\u5de8\u57fa","i":2},
{"id":146,"name":"\u8c22\u9706\u950b","i":2},{"id":171,"name":"\u6768\u5343\u5b05","i":2},{"id":5194,"name":"MC\u68a6","i":2},{"id":5437,"name":"\u5c9b\u8c37\u77b3","i":2},{"id":9426,"name":"X Japan","i":2},{"id":2924,"name":"Jay-Z","i":2},{"id":4615,"name":"\u674e\u5b87\u6625","i":2},{"id":174,"name":"\u5f20\u5b66\u53cb","i":2},{"id":163,"name":"\u5218\u5fb7\u534e","i":2},{"id":4365,"name":"\u5468\u4f20\u96c4","i":2},{"id":159,"name":"\u80e1\u5f66\u658c","i":2},{"id":4411,"name":"\u738b\u7b5d","i":2},
{"id":11979,"name":"\u4e01\u5f53","i":2},{"id":5398,"name":"\u5016\u7530\u4f86\u672a","i":2},{"id":30873,"name":"love solfege","i":2},{"id":1496,"name":"Green Day","i":2},{"id":5302,"name":"Muse","i":2},{"id":230,"name":"\u8fea\u514b\u725b\u4ed4","i":2},{"id":219,"name":"\u5f20\u656c\u8f69","i":2},{"id":4359,"name":"\u6f58\u73ae\u67cf","i":2},{"id":6028,"name":"A-Lin","i":2},{"id":173,"name":"\u9648\u6167\u7433","i":2},{"id":6130,"name":"\u51e4\u98de\u98de","i":2},{"id":4605,"name":"\u5f26\u5b50",
"i":2},{"id":5422,"name":"\u690e\u540d\u6797\u6a8e","i":2},{"id":5087,"name":"\u5b87\u591a\u7530\u5149","i":2},{"id":965,"name":"David Guetta","i":2},{"id":89,"name":"\u5f20\u9707\u5cb3","i":2},{"id":6415,"name":"Evanescence","i":2},{"id":6621,"name":"\u66f9\u683c","i":2},{"id":224,"name":"\u5f20\u97f6\u6db5","i":2},{"id":4518,"name":"\u9ed1\u8c79","i":2},{"id":75,"name":"\u4f0d\u4f70","i":2},{"id":5941,"name":"\u65fa\u798f","i":2},{"id":5195,"name":"\u5e73\u4e95\u575a","i":2},{"id":15370,"name":"\u4e09\u679d\u5915\u590f",
"i":2},{"id":5705,"name":"\u5c9a","i":2},{"id":11304,"name":"Guns N'Roses","i":2},{"id":1066,"name":"\u65b9\u5927\u540c","i":2},{"id":8440,"name":"Florence + The Machine","i":2},{"id":4651,"name":"\u7f57\u5fd7\u7965","i":2},{"id":11593,"name":"Enrique Iglesias","i":2},{"id":4604,"name":"\u6c6a\u5cf0","i":2},{"id":11626,"name":"\u90ed\u9759","i":2},{"id":5558,"name":"\u5f20\u60ac","i":2},{"id":15961,"name":"2NE1","i":2},{"id":5438,"name":"\u4ed3\u6728\u9ebb\u8863","i":2},{"id":14207,"name":"IU","i":2},
{"id":4946,"name":"The Eagles","i":2},{"id":1577,"name":"\u6768\u5e42","i":2},{"id":4736,"name":"Akon","i":2},{"id":4709,"name":"Celine Dion","i":2},{"id":167,"name":"\u5f20\u4fe1\u54f2","i":2},{"id":4351,"name":"\u8303\u73ae\u742a","i":2},{"id":4367,"name":"\u738b\u5fc3\u51cc","i":2},{"id":5613,"name":"H.O.T.","i":2},{"id":13959,"name":"2PM","i":2},{"id":165,"name":"\u8427\u4e9a\u8f69","i":2},{"id":5684,"name":"w-inds.","i":2},{"id":12492,"name":"\u738b\u82e5\u7433","i":2},{"id":290,"name":"Coldplay",
"i":2},{"id":4681,"name":"James Blunt","i":2},{"id":4718,"name":"Pink","i":2},{"id":178,"name":"\u5434\u514b\u7fa3","i":2},{"id":4658,"name":"\u6768\u4e1e\u7433","i":2},{"id":4422,"name":"\u725b\u5976\u5496\u5561","i":2},{"id":4983,"name":"Maroon 5","i":2},{"id":12855,"name":"Lady Antebellum","i":2},{"id":13841,"name":"SHINee","i":2},{"id":5595,"name":"\u5c0f\u4e8b\u4e50\u56e2","i":2},{"id":4762,"name":"Usher","i":2},{"id":13948,"name":"\u9093\u7d2b\u68cb","i":2},{"id":6966,"name":"Rihanna","i":2},
{"id":4586,"name":"Black Eyed Peas","i":2},{"id":7221,"name":"\u8bb8\u5d69","i":2},{"id":227,"name":"\u8521\u4f9d\u6797","i":2},{"id":2923,"name":"Linkin Park","i":2},{"id":4708,"name":"Britney Spears","i":2},{"id":4716,"name":"Madonna","i":2},{"id":8394,"name":"\u5362\u5e7f\u4ef2","i":2},{"id":4161,"name":"Beyonce Knowles","i":2},{"id":4712,"name":"\u8fc8\u514b\u5c14\u00b7\u6770\u514b\u900a","i":2},{"id":11760,"name":"Sara Bareilles","i":2},{"id":11733,"name":"BigBang","i":2},{"id":11809,"name":"\u5c11\u5973\u65f6\u4ee3",
"i":2},{"id":4800,"name":"\u6ee8\u5d0e\u6b65","i":2},{"id":4915,"name":"\u4e1c\u65b9\u795e\u8d77","i":2},{"id":5484,"name":"\u8521\u598d","i":2},{"id":4435,"name":"\u5b9d\u513f","i":2},{"id":4706,"name":"Rain","i":2},{"id":5829,"name":"\u51e4\u51f0\u4f20\u5947","i":2},{"id":11921,"name":"Taylor Swift","i":2},{"id":13157,"name":"Katy Perry","i":2},{"id":6033,"name":"\u5434\u96e8\u970f","i":2},{"id":6499,"name":"\u5f20\u6770","i":2},{"id":11761,"name":"\u7b77\u5b50\u5144\u5f1f","i":2},{"id":5924,"name":"\u82cf\u6253\u7eff",
"i":2},{"id":1059,"name":"\u4f55\u665f\u94ed","i":2},{"id":2,"name":"BEYOND","i":2},{"id":5371,"name":"SARA","i":2},{"id":7298,"name":"\u9648\u745e","i":2},{"id":4713,"name":"\u9093\u4e3d\u541b","i":2},{"id":4427,"name":"\u4fe1\u4e50\u56e2","i":2},{"id":139,"name":"\u738b\u6770","i":2},{"id":62,"name":"\u4efb\u8d24\u9f50","i":2}],"type3":[{"id":136,"name":"\u4f24\u611f","i":3},{"id":137,"name":"\u5bc2\u5bde","i":3},{"id":138,"name":"\u751c\u871c","i":3},{"id":140,"name":"\u5feb\u4e50","i":3},{"id":139,
"name":"\u52b1\u5fd7","i":3}]}};var fmType=1,curFm=MP.fm.fmListData["fmInfoObj"]["type1"][0],fmId=curFm.id,fmName=curFm.name;MP.fm.curFmInfo={fmId:fmId,fmType:fmType,fmName:fmName};MP.fm.loadFmSonglist(MP.fm.curFmInfo,function(songlist){(function(curSong){th.setCurSongInfo(curSong);MP.fm.isDefaultFm=true})(songlist[0])})})};th.resetProgress=function(w){w=w||0;try{MP.dom.setStyle(MP.getById(domConfig.divSongbarLine),"width","0%")}catch(e){MP.console.print("resetProgress exception: "+e.message)}};th.resumeMusic=
function(){try{var radio=MP.cookie.get("radio");if(!!radio&&radio.split("|")[0]==MP.user.getLoginUin()){if(th.PlayerOp.type=="fm")th.getLocalMpList(function(){th.resumeFm()});else if(th.PlayerOp.type=="pl")th.getLocalMpList(function(){th.resumePlaylist()});return}th.setDefaultFm();th.resetProgress()}catch(e){MP.console.print("resumeMusic exp: ",e.message)}};var localList=null;th.getLocalMpList=function(callback){!MUSIC.widget.Storage&&(MUSIC.widget.Storage=MP.Storage);g_storage.get("mplist"+MP.user.getLoginUin(),
function(data){var tmplist=[];if(!!data)if(window.JSON&&window.JSON.parse)try{tmplist=JSON.parse(data)}catch(ex){MP.console.print("parse mpList exp: ",ex.message);tmplist=MP.lang.isArray(data)?data:[]}else tmplist=MP.lang.isArray(data)?data:eval(data);MP.console.print("getLocalMpList, tmplist:",tmplist,typeof tmplist);localList=tmplist;!!callback&&callback()})};th.resumeFm=function(){var tmplist=localList;MP.console.print("resumeMusic 1, localList: ",localList,"; localList.length",localList.length);
if(tmplist.length>0){var musicState=MP.cookie.get("miniplayer-radio");MP.cookie.del("miniplayer-radio",document.domain,"/");MP.console.print("resumeMusic 5,musicState:",musicState);if(!musicState){th.setDefaultFm();return}var arrayState=musicState.split(","),lastTime=parseInt(arrayState[4],10),curTime=+new Date;var lastUrl=arrayState[6];if(arrayState[2]=="true")MP.addedPlayerDomain=true;if(lastUrl==undefined||lastUrl==location.href){MP.console.print("resumeMusic 7");if(arrayState[2]=="true")MP.initMusic(function(){if(!!MP.BQQPlayer){MP.BstopPlayer();
th.setDefaultFm();th.resetProgress()}});th.setDefaultFm();th.resetProgress();return false}var timeSpan=curTime-lastTime;if(timeSpan<=3*60*1E3&&timeSpan>=0&&arrayState[2]=="true"){MP.initMusic(function(){MP.console.print("resumeMusic 8,");MP.pauseFromApp=false;if(MP.getPlayer()){MP.console.print("resumeMusic 9,");MP.getPlayer().mPlayList.mpList=tmplist;tmplist[0].malbumid=arrayState[5];var songInfo=tmplist[0];songInfo.mid=songInfo.mSongId;songInfo.msong=songInfo.mSongName;songInfo.msinger=songInfo.mSingerName;
th.PlayerOp.curSongInfo=songInfo;th.setCurSongInfo(songInfo);MP.console.print("resumeMusic 10,",songInfo.mSongName,songInfo.mSingerName,songInfo.malbumid)}var fmIdType=arrayState[3].split("_");if(fmIdType.length>2){MP.fm.curFmInfo={fmId:fmIdType[0],fmType:fmIdType[1],fmName:fmIdType[2]};MP.fm.loadFmSonglist(MP.fm.curFmInfo,function(songList){g_webPlayer.setPlayerList(false,songList,th.PlayerOp.curSettings.mode)})}var curPos=0;if(!!MP.BQQPlayer&&MP.compareVer(MP.BQQPlayer.plv,"8.5.2011.228")>=0){MP.console.print("resumeMusic 11,");
MP.BQQPlayer.mPlayingPos=curPos;th.PlayerOp.isPlaying=true;th.PlayerOp.setPlayBtn(0);MP.console.print("resumeMusic 12, ",arrayState[7]);th.resetProgress(arrayState[7]||0);return true}else{MP.console.print("resumeMusic 13,");var volume=""+g_webPlayer.getVolumn();if(!!ua.chrome||MP.VFlashPlayer)g_webPlayer.setVolumn(0);if(!MP.VFlashPlayer)MP.BmutePlayer();MP.BrunPlayer(curPos);th.PlayerOp.isPlaying=true;th.PlayerOp.setPlayBtn(0);setTimeout(function(){try{MP.setPlayProgressTime(arrayState[1]);if(!MP.VFlashPlayer)MP.BmutePlayer();
if(!!ua.chrome||MP.VFlashPlayer){var vol=MP.cookie.get("fmvol")||"75";g_webPlayer.setVolumn(vol)}}catch(e){MP.console.print("resumeMusic 3076 exp:",e.message)}},3E3)}});return true}}else{!!g_webPlayer&&g_webPlayer.stopPlayer();th.setDefaultFm();th.resetProgress()}};th.resumePlaylist=function(){if(localList.length>0)th.localSong.get(function(list){try{MP.console.print("resumePlaylist 1: "+MP.cookie.get("radio"));if(list.length>0){var musicState=MP.cookie.get("miniplayer-playerlist");MP.cookie.del("miniplayer-playerlist",
document.domain,"/");MP.console.print("resumePlaylist 6,musicState:",musicState);if(!musicState){th.setDefaultFm();return}var arrayState=musicState.split(","),lastTime=parseInt(arrayState[3],10),curTime=+new Date,lastUrl=arrayState[4];MP.console.print("resumePlaylist 7,lastUrl:",lastUrl,"curUrl:",location.href,"playSrc:");if(arrayState[2]=="true")MP.addedPlayerDomain=true;var _cPos=Number(arrayState[0])<0?0:Number(arrayState[0]),songInfo=list[_cPos];th.PlayerOp.curSongInfo=songInfo;MP.console.print("resumePlaylist 19, songInfo: "+
th.PlayerOp.curSongInfo);if(lastUrl==undefined||lastUrl==location.href){MP.console.print("resumePlaylist 8");if(arrayState[2]=="true")MP.initMusic(function(){if(!!MP.BQQPlayer){MP.BstopPlayer();th.setDefaultFm();th.resetProgress()}});th.setDefaultFm();th.resetProgress();return false}var timeSpan=curTime-lastTime;if(timeSpan<=5*60*1E3&&timeSpan>=0&&arrayState[2]=="true"){MP.initMusic(function(){MP.console.print("resumePlaylist 9,");MP.pauseFromApp=false;MP.console.print("resumePlaylist 18, MP.getPlayer: "+
MP.getPlayer());if(MP.getPlayer()){MP.console.print("resumePlaylist 10, mpList: ",localList,"; mpList.length:",localList.length);g_webPlayer.setPlayerList(false,list,2);MP.getPlayer().mPlayList.mpList=localList;th.PlayerOp.mPlayingPos=_cPos;g_webPlayer.getPlayerList().setPostion(_cPos);th.setCurSongInfo(songInfo);MP.console.print("resumePlaylist 11,",songInfo.msong,songInfo.msinger,songInfo.malbumid)}var curPos=0;if(!!MP.BQQPlayer&&MP.compareVer(MP.BQQPlayer.plv,"8.5.2011.228")>=0){MP.console.print("resumePlaylist 12, curPos: "+
curPos);MP.BQQPlayer.mPlayingPos=curPos;th.PlayerOp.isPlaying=true;th.PlayerOp.setPlayBtn(0);return true}else{var volume=""+g_webPlayer.getVolumn();if(!!ua.chrome||MP.VFlashPlayer)g_webPlayer.setVolumn(0);if(!MP.VFlashPlayer)MP.BmutePlayer();MP.BrunPlayer(curPos);th.PlayerOp.isPlaying=true;th.PlayerOp.setPlayBtn(0);setTimeout(function(){try{MP.setPlayProgressTime(arrayState[1]);if(!MP.VFlashPlayer)MP.BmutePlayer();if(!!ua.chrome||MP.VFlashPlayer){var vol=MP.cookie.get("fmvol")||"75";g_webPlayer.setVolumn(vol)}}catch(e){MP.console.print("resumePlaylist 3076 exp:",
e.message)}},3E3)}});return true}else{th.setDefaultFm();th.resetProgress()}}else{th.setDefaultFm();th.resetProgress()}}catch(e){MP.console.print("resumePlaylist,exception:",e.message)}});else{th.setDefaultFm();th.resetProgress()}return false};th.beforeUnload=function(){var $divSongbarLine=MP.getById(domConfig.divSongbarLine);try{var oplayer="getPlayer"in MP?MP.getPlayer():null;var isPlaying=th.PlayerOp.isPlaying;if(!!isPlaying)if(th.PlayerOp.type=="fm"){MP.cookie.set("miniplayer-radio",""+oplayer.mPlayingPos+
","+oplayer.mCurPlayPos+","+isPlaying+","+MP.fm.curFmInfo.fmId+"_"+MP.fm.curFmInfo.fmType+"_"+MP.fm.curFmInfo.fmName+","+(new Date).getTime()+","+(g_webPlayer.getSongInfoObj().malbumid||0)+","+location.href+","+$divSongbarLine.style.width,document.domain,"/");MP.cookie.set("radio",MP.user.getLoginUin()+"|"+(!!MP.BQQPlayer?MP.BQQPlayer.mPlayerSource:"miniplayer_player")+"|"+"FM",document.domain,"/")}else if(th.PlayerOp.type=="pl"){MP.cookie.set("miniplayer-playerlist",""+th.PlayerOp.mPlayingPos+","+
oplayer.mCurPlayPos+","+isPlaying+","+(new Date).getTime()+","+location.href+","+(g_webPlayer.getSongInfoObj().malbumid||0)+","+$divSongbarLine.style.width,document.domain,"/");MP.cookie.set("radio",MP.user.getLoginUin()+"|"+(!!MP.BQQPlayer?MP.BQQPlayer.mPlayerSource:"miniplayer_player")+"|"+"PL",document.domain,"/")}}catch(e){MP.console.print("exp: "+e.message)}!!MP.tj2rp&&MP.tj2rp.statSong()};MP.event.on(window,"beforeunload",th.beforeUnload)}}(window.MP);exports.playerCtrl=new PlayerCtrl});
/*  |xGv00|f994a577e82fbe29d5464d8a4bd7639b */